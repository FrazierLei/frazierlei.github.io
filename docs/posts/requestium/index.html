<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Feifei">
    <meta name="description" content="">
    <meta name="keywords" content="blog, murmur">

    <meta property="og:site_name" content="éœéœ">
    <meta property="og:title" content="
  Requestium = Requests &#43; Selenium - éœéœ
">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/posts/requestium/">
    <meta property="og:image" content="images/tn.png">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="/posts/requestium/">
    <meta name="twitter:image" content="images/tn.png">

    <base href="../../posts/requestium/">
    <title>
  Requestium = Requests &#43; Selenium - éœéœ
</title>

    <link rel="canonical" href="../../posts/requestium/">
    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
    
    <link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700">
    <link rel="stylesheet" href="../../css/normalize.min.css">
    <link rel="stylesheet" href="../../css/style.min.css">

    

    

    <link rel="icon" type="image/png" href="../../images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../images/favicon-16x16.png" sizes="16x16">

    
      <link rel="alternate" href="../../index.xml" type="application/rss+xml" title="éœéœ">
      <link href="../../index.xml" rel="feed" type="application/rss+xml" title="éœéœ" />
    

    <meta name="generator" content="Hugo 0.86.0" />
  </head>

  <body class="">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="../../">éœéœ</a>
    <input type="checkbox" id="menu-control"/>
    <label class="menu-mobile  float-right " for="menu-control">
      <span class="btn-mobile  float-right ">&#9776;</span>
      <ul class="navigation-list">
        
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="posts">Blog</a>
            </li>
          
            <li class="navigation-item  align-center ">
              <a class="navigation-link" href="about">About</a>
            </li>
          
        
        
      </ul>
    </label>
  </section>
</nav>





      <div class="content">
        
  <section class="container post">
  <article>
    <header>
      <h1 class="title">Requestium = Requests &#43; Selenium</h1>
      <h2 class="date">December 22, 2020</h2>

      
    </header>

    <p><img src="http://qiniusave.feifeizaici.xyz/uPic/32966130-8bb15b00-cbb7-11e7-9faf-85963ec5bd82.png" alt="Requestium"></p>
<p>è¿™ä¸ªæ¡†æ¶æ˜¯æˆ‘åœ¨çŸ¥ä¹ã€ŒPythonæœ‰å“ªäº›å¸¸è§çš„ã€å¥½ç”¨çš„çˆ¬è™«æ¡†æ¶ï¼Ÿã€çš„é«˜èµç­”æ¡ˆä¸­çœ‹åˆ°çš„ï¼Œè¯•ç€ç”¨äº†ä¸€ä¸‹ï¼Œè¿˜æŒºå¥½ç©ã€‚</p>
<p>ä¸‹é¢çš„å†…å®¹ä¸»è¦æ¥è‡ª<code>Requestsium</code>çš„GitHubä¸Šçš„ä»‹ç»ï¼šhttps://github.com/tryolabs/requestiumï¼Œå°‘é‡æ˜¯æˆ‘è‡ªå·±çš„æµ‹è¯•ä»£ç ã€‚</p>
<h2 id="å®šä½">å®šä½</h2>
<p><code>Requestium</code>æ˜¯é›†<code>Requests</code>å’Œ<code>Selenium</code>äºä¸€ä½“çš„WEBè‡ªåŠ¨åŒ–å·¥å…·ã€‚<code>Requestium</code>å¯ä»¥çœ‹ä½œæ˜¯åœ¨<code>Requests</code>ä¸ºä¸»ä½“çš„åŸºç¡€ä¸Šå¢åŠ äº†<code>Selenium</code>çš„éƒ¨åˆ†åŠŸèƒ½ï¼Œå¦‚æœä½ éœ€è¦ä¸€ä¸ªä»¥<code>Selenium</code>ä¸ºä¸»ä½“ï¼Œå¢åŠ éƒ¨åˆ†<code>Requests</code>åŠŸèƒ½çš„Pythonåº“ï¼Œå¯ä»¥å»çœ‹ä¸€ä¸‹ å¦ä¸€ä¸ªå«åš<code>Selenium-Requests</code>çš„åº“ã€‚</p>
<p><code>Requestium</code>æœ€ä¸»è¦çš„ç‰¹æ€§æ˜¯èƒ½å¤Ÿ<strong>åœ¨ä¿æŒå½“å‰Webä¼šè¯çš„åŒæ—¶ï¼Œå…è®¸åœ¨Requestsçš„Sessionå’ŒSeleniumçš„Webdriverä¹‹é—´åˆ‡æ¢ã€‚</strong></p>
<h2 id="å®‰è£…æ–¹æ³•">å®‰è£…æ–¹æ³•</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">pip install requestium
</code></pre></div><h2 id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</h2>
<p>å¯¹äºèƒ½å¤Ÿç†Ÿç»ƒä½¿ç”¨<code>Requests</code>å’Œ<code>Selenium</code>çš„äººæ¥è¯´ï¼Œå­¦ä¹ <code>Requestium</code>å‡ ä¹æ²¡æœ‰ä»€ä¹ˆæˆæœ¬ï¼ˆ<code>Requestium</code>çš„æºç ä¸€å…±ä¹Ÿåªæœ‰400å¤šè¡Œï¼‰ã€‚å¦‚æœä¸ç†Ÿæ‚‰çš„è¯è¿˜æ˜¯è¦å…ˆå»å­¦ç€ä¸¤ä¸ªåº“ï¼Œæœ€å¥½çš„å­¦ä¹ èµ„æ–™å°±æ˜¯å®ƒä»¬çš„å®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªsessionï¼Œåˆå§‹åŒ–å‚æ•°åŒ…å«<code>webdriver</code>çš„è·¯å¾„ï¼Œæµè§ˆå™¨ï¼Œtimeoutæ—¶é™ï¼Œä»¥åŠ<code>webdriver</code>æ‰€éœ€å‚æ•°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">requestium</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">Keys</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">webdriver_path</span><span class="o">=</span><span class="s1">&#39;./chromedriver&#39;</span><span class="p">,</span>
            <span class="n">browser</span><span class="o">=</span><span class="s1">&#39;chrome&#39;</span><span class="p">,</span>
            <span class="n">default_timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">webdriver_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;arguments&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;headless&#39;</span><span class="p">]})</span>
</code></pre></div><p>è‡³äºæµè§ˆå™¨ï¼Œ<code>Requestium</code>åªæ”¯æŒ<code>PhantomJS</code>å’Œ<code>Chrome</code>ï¼Œé‰´äº<code>PhantomJS</code>å·²æ­»ï¼Œä½œè€…çŸ­æ—¶é—´å†…æ²¡æœ‰æ›´æ–°è¿™ä¸ªä¸Šæ¬¡commitæ˜¯2018å¹´2æœˆçš„åº“ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸º<code>Requestium</code>åªæ”¯æŒ<code>Chrome</code>ï¼Œå½“ç„¶è‡ªå·±å†™ä¸€ä¸ªæ”¯æŒå…¶ä»–æµè§ˆå™¨çš„ç‰ˆæœ¬ä¹Ÿå¹¶ééš¾äº‹ã€‚</p>
<p><img src="https://qiniusave.feifeizaici.xyz/uPic/image-20201211222034854.png" alt="æœ‰äººæƒ³ç”¨Firefox"></p>
<p>å’Œ<code>Requests</code>ä¸åŒï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨è§£ææ”¶åˆ°çš„å“åº”ï¼Œå½“è°ƒç”¨xpathï¼Œcssï¼Œreçš„æ—¶å€™ï¼Œè§£æä¼šè‡ªåŠ¨å®Œæˆï¼Œä¾‹å¦‚è¿™æ ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">title</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://samplesite.com&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//title/text()&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">extract_first</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;Default Title&#39;</span><span class="p">)</span>
</code></pre></div><p><code>Requestium</code>çš„sessionå¯¹è±¡æœ¬è´¨ä¸Šå°±æ˜¯<code>Requests</code>çš„sessionå¯¹è±¡ï¼Œæ‰€ä»¥å®ƒåŸæœ¬è‡ªå¸¦çš„æ–¹æ³•éƒ½å¯ä»¥ç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://www.samplesite.com/sample&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;field1&#39;</span><span class="p">:</span> <span class="s1">&#39;data1&#39;</span><span class="p">})</span>
<span class="n">s</span><span class="o">.</span><span class="n">proxies</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://10.11.4.254:3128&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="s1">&#39;https://10.11.4.252:3128&#39;</span><span class="p">})</span>
</code></pre></div><p>ä¹Ÿå¯ä»¥åˆ‡æ¢åˆ°<code>webdriver</code>æ¨¡å¼æ¥è¿è¡Œjsä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">s</span><span class="o">.</span><span class="n">transfer_session_cookies_to_driver</span><span class="p">()</span>  <span class="c1"># You can maintain the session if needed</span>
<span class="n">s</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://www.samplesite.com/sample/process&#39;</span><span class="p">)</span>
</code></pre></div><p><code>Requestium</code>çš„session.driverå¯¹è±¡æœ¬è´¨ä¸Šå°±æ˜¯<code>Selenium</code>çš„driverå¯¹è±¡ï¼Œæ‰€ä»¥å®ƒåŸæœ¬è‡ªå¸¦çš„æ–¹æ³•éƒ½å¯ä»¥ç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">s</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&#34;//input[@class=&#39;user_name&#39;]&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;James Bond&#39;</span><span class="p">,</span> <span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>

<span class="c1"># New method which waits for element to load instead of failing, useful for single page web apps</span>
<span class="n">s</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">ensure_element_by_xpath</span><span class="p">(</span><span class="s2">&#34;//div[@attribute=&#39;button&#39;]&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</code></pre></div><p>é™¤äº†åŸæœ¬è‡ªå¸¦çš„å‡½æ•°ï¼Œrequestiumçš„session.driverå¯¹è±¡è¿˜æœ‰xpathï¼Œcssï¼Œreæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å®šä½ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">re</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;ID_\d\w\d some_pattern&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Found it!&#39;</span><span class="p">)</span>
</code></pre></div><p>åˆ‡æ¢å›sessionæ¨¡å¼åŒæ ·ç®€å•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">s</span><span class="o">.</span><span class="n">transfer_driver_cookies_to_session</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://www.samplesite.com/sample2&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="s1">&#39;value1&#39;</span><span class="p">})</span>
</code></pre></div><h2 id="ensure-æ–¹æ³•">ensure æ–¹æ³•</h2>
<p><code>Requestium</code>çš„å¦ä¸€å¤§ç‰¹ç‚¹æ˜¯å¢åŠ äº†ä¸€ç³»åˆ—<code>ensure</code> æ–¹æ³•ï¼Œå¯ä»¥ç¡®ä¿driverç¡®å®å‘ç°äº†æŒ‡å®šå…ƒç´ æˆ–è€…è½¬ç§»äº†cookieã€‚</p>
<p>å¦‚æœä½¿ç”¨çš„æ˜¯<code>Selenium</code>çš„ <code>find_element_by_</code>æ–¹æ³•ï¼Œä¸€æ—¦driveræ²¡æœ‰å‘ç°æˆ‘ä»¬æƒ³è¦çš„å…ƒç´ ï¼Œå°±ä¼šç«‹åˆ»æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚è€Œ<code>Requestium</code>åˆ™ä¼šç­‰å¾…è¿™ä¸ªå…ƒç´ çš„å‡ºç°ã€‚ä¸‹é¢æ˜¯å››ä¸ª<code>Requestium</code>å¯ä»¥ç­‰å¾…çš„çŠ¶æ€ï¼š</p>
<ul>
<li>present ï¼ˆé»˜è®¤ï¼‰</li>
<li>clickable</li>
<li>visible</li>
<li>invisible (ä¾‹å¦‚ç­‰å¾…<em>loading&hellip;</em> æ¶ˆå¤±)</li>
</ul>
<h2 id="ä¸€äº›å¯¹æ¯”çš„ä¾‹å­">ä¸€äº›å¯¹æ¯”çš„ä¾‹å­</h2>
<h3 id="å®˜ç½‘ä¸Šçš„ä¸€ä¸ªä¾‹å­ç™»å½•reddit">å®˜ç½‘ä¸Šçš„ä¸€ä¸ªä¾‹å­ï¼šç™»å½•Reddit</h3>
<p>ä½¿ç”¨<code>Requestium</code>æ—¶çš„ä»£ç é‡åªæœ‰ä½¿ç”¨<code>Requests + Selenium + lxml</code>çš„ä¸€åŠã€‚ï¼ˆå¯ä¸æ˜¯å˜›ï¼Œä½ æŠŠå¥½å¤š<code>try...except</code>éƒ½ç”¨<code>ensure</code>å°è£…èµ·æ¥äº†ğŸ˜…ï¼‰ã€‚</p>
<p><img src="https://qiniusave.feifeizaici.xyz/uPic/carbon%20(2).png" alt="ç”¨Requestiumç™»å½•Reddit"></p>
<p><img src="https://qiniusave.feifeizaici.xyz/uPic/carbon%20(3).png" alt="ç”¨Requests+Seleniumç™»å½•Reddit"></p>
<h3 id="ä¸€ä¸ªä¾‹å­ç”¨requestiumç™»å½•æµ™å¤§é€šè¡Œè¯">ä¸€ä¸ªä¾‹å­â€”â€”ç”¨Requestiumç™»å½•æµ™å¤§é€šè¡Œè¯</h3>
<p>é€Ÿåº¦è¦æ…¢ä¸€ç‚¹ï¼Œä½†æ˜¯å†™èµ·æ¥ä¸ç”¨åŠ¨è„‘å­ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">requestium</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">Keys</span>

<span class="n">login_url</span> <span class="o">=</span> <span class="s1">&#39;https://zjuam.zju.edu.cn/cas/login&#39;</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">webdriver_path</span><span class="o">=</span><span class="s1">&#39;/usr/local/bin/chromedriver&#39;</span><span class="p">,</span>
            <span class="n">browser</span><span class="o">=</span><span class="s1">&#39;chrome&#39;</span><span class="p">,</span>
            <span class="n">default_timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">webdriver_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;arguments&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;headless&#39;</span><span class="p">]}</span>
           <span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">login_url</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&#34;//*[@id=&#39;username&#39;]&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&#34;//*[@id=&#39;password&#39;]&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">Keys</span><span class="o">.</span><span class="n">ENTER</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">transfer_driver_cookies_to_session</span><span class="p">()</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">login_url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;nick: </span><span class="se">\&#39;</span><span class="s1">(.*?)</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;ç™»å½•æˆåŠŸ!&#39;</span><span class="p">)</span>
</code></pre></div>
  </article>

  <br/>

  
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "yourdiscussshortname" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  
  
</section>

      </div>
      
        <footer class="footer">
  <section class="container">
    
      <div class="sns-shares sp-sns-shares">
        
        
        
        
        
      </div>
    
    
      <p>Hello, world.</p>
    
     Â© 2021    Â·  Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/naro143/hugo-coder-portfolio">CoderPortfolio</a>. 

  </section>
</footer>
<div class="fixed-bar">
  <section class="container">
    
      <p id="privateTriggerText">éœéœåœ¨å“ª<a id="privateTrigger">Click!</a></p>
    
    
      <div class="sns-shares pc-sns-shares">
        
        
        
        
        
      </div>
    
  </section>
</div>

      
    </main>

    

  <script src="../../js/app.js"></script>
  
  <script>
  (function($) {
    $(function() {
      $('#privateTrigger').on('click', function() {
        $('.private').slideToggle();
        $('#privateTriggerText').text("éœéœåœ¨æ­¤");
      });
    });
   })(jQuery);
  </script>
  
  </body>
</html>
